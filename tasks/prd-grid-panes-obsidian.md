# Grid Panes - Obsidian 网格面板插件

## 概述

Grid Panes 是一个 Obsidian 插件，提供"网格面板"视图，让用户在同一屏幕中平铺对照多个笔记。解决现有 split/多窗方案缺乏"网格化 + 一键增减 + 空格占位 + 布局持久化"的痛点。

## 目标用户

- 需要同时对比多篇笔记的研究者、写作者
- 进行主题整理、资料汇总的知识工作者
- 希望快速切换不同笔记组合的 Obsidian 用户

## 核心功能

### 1. 网格视图

| 特性 | 描述 |
|------|------|
| 默认布局 | 2×2 空网格（四格） |
| 尺寸范围 | 最小 1×1，最大 5×5 |
| 渲染模式 | 预览模式为主，支持切换到编辑模式 |

### 2. 网格操作

#### 增加行/列
- 网格边缘 hover 显示 `+` 按钮
- 点击边缘按钮即增加对应行/列
- 同时支持右键菜单 / 命令面板操作

#### 减少行/列
- 右键菜单 / 命令面板操作
- 最小保留 1×1

### 3. 单元格操作

| 操作 | 交互方式 |
|------|----------|
| 选择笔记 | 点击空格 → 打开 Obsidian 原生文件搜索弹窗（Quick Switcher 风格） |
| 更换笔记 | 单元格菜单 → 重新选择 |
| 清空 | 单元格菜单 → 清空当前格 |
| 新窗口打开 | 单元格菜单 → 在新 pane 打开该 note |
| 切换模式 | 单元格菜单 → 预览/编辑模式切换 |

### 4. 空格占位

- 显示占位 UI：虚线框 + "点击选择笔记" 提示文字
- 点击触发笔记选择器

### 5. 布局持久化

| 特性 | 描述 |
|------|------|
| 文件格式 | JSON |
| 文件扩展名 | `.gridpanes` |
| 保存时机 | 自动保存（每次修改后自动持久化） |
| 兼容性 | 可同步、可分享、可版本控制 |

#### `.gridpanes` 文件结构示例

```json
{
  "version": 1,
  "rows": 2,
  "cols": 2,
  "cells": [
    { "row": 0, "col": 0, "notePath": "notes/note1.md", "mode": "preview" },
    { "row": 0, "col": 1, "notePath": null, "mode": "preview" },
    { "row": 1, "col": 0, "notePath": "notes/note2.md", "mode": "preview" },
    { "row": 1, "col": 1, "notePath": "notes/note3.md", "mode": "edit" }
  ]
}
```

## 入口与交互

### 创建新网格

1. **Ribbon 图标**：点击侧边栏图标 → 创建新 `.gridpanes` 文件
2. **命令面板**：`Grid Panes: Create New Grid` → 创建新文件

### 打开已有网格

- 双击 `.gridpanes` 文件 → 自动以网格视图打开
- 文件浏览器中显示专属图标

## 技术约束

| 约束 | 说明 |
|------|------|
| 目标平台 | 仅桌面端（Windows/macOS/Linux） |
| Obsidian API | 使用 `WorkspaceLeaf`、`MarkdownRenderer` 等标准 API |
| 性能考量 | 最大 5×5 = 25 格，每格独立渲染 |

## 命令列表

| 命令 | 描述 |
|------|------|
| `Grid Panes: Create New Grid` | 创建新的网格布局文件 |
| `Grid Panes: Add Row Above` | 在顶部添加一行 |
| `Grid Panes: Add Row Below` | 在底部添加一行 |
| `Grid Panes: Add Column Left` | 在左侧添加一列 |
| `Grid Panes: Add Column Right` | 在右侧添加一列 |
| `Grid Panes: Remove Row` | 删除当前行（需确认） |
| `Grid Panes: Remove Column` | 删除当前列（需确认） |

## UI 草图

```
┌─────────────────────────────────────────────────┐
│  Grid: research-comparison.gridpanes       [×]  │
├────────────────────┬────────────────────────────┤
│  ┌──────────────┐  │  ┌──────────────────────┐  │
│  │ Note A       │  │  │ Note B               │  │
│  │ (preview)    │  │  │ (preview)            │  │
│  │              │  │  │                      │  │
│  │ Content...   │  │  │ Content...           │  │
│  └──────────────┘  │  └──────────────────────┘  │
├─────────[+]────────┼────────────[+]─────────────┤
│  ┌──────────────┐  │  ┌ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┐  │
│  │ Note C       │  │                           │
│  │ (edit)       │  │  │  点击选择笔记         │  │
│  │              │  │                           │
│  │ Content...   │  │  └ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┘  │
│  └──────────────┘  │                            │
└────────────────────┴────────────────────────────┘
      [+]                        [+]
```

## 非目标（MVP 不包含）

- 拖拽调整单元格顺序
- 合并单元格（跨行/列显示）
- 网格模板
- 移动端支持

## 成功指标

- 用户能在 30 秒内创建一个 2×2 网格并填入 4 个笔记
- 布局文件能正确同步到其他设备并还原
- 增减行列操作响应时间 < 100ms